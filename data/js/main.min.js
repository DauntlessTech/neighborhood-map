function ViewModel(e,t,n){function r(e,n,r,o,l){cityMarkersArr.length>0&&(cityMarkersArr[0].setMap(null),cityMarkersArr=[],$("#info").text(""),$(a()).each(function(e){a()[e].setMap(null)}),a([]),l([]),i([])),n.geocode({address:r},function(n,c){if(c===google.maps.GeocoderStatus.OK){t=n[0].geometry.location,e.setCenter(n[0].geometry.location),e.setZoom(14),s.cityMarker=new google.maps.Marker({map:e,position:t,icon:"https://maps.gstatic.com/mapfiles/ms2/micons/red-dot.png",draggable:!1,infowindow:new google.maps.InfoWindow({content:r})}),s.cityMarker.infowindow.open(e,s.cityMarker),cityMarkersArr.push(s.cityMarker);{$.get("https://api.foursquare.com/v2/venues/search?&client_id=4DZ0UPQETEOFEHOWZHKDEDAVMELD1WW5GQWQWRM25M2IZSNS&client_secret=BTQAOLRHOAJPDQKYDG0I4XOPWPH4W5IZGDVNGZCXT1TCEWTF&v=20130815&ll="+t.lat()+", "+t.lng()+"&query="+o,function(t){console.log("api call succeded: "+new Date);var n;$(t.response.venues).each(function(r){n={lat:t.response.venues[r].location.lat,lng:t.response.venues[r].location.lng};var o=t.response.venues[r].name;null===o&&(o="Not Available");var c=t.response.venues[r].url,p=c;null===c&&(c="javascript: void(0)",p="Not Available");var u=t.response.venues[r].contact.formattedPhone;null===u&&(u="Not Available");var f=t.response.venues[r].contact.twitter;f=null===f?"Not Available":"@"+f;var m='<article class="uk-comment infowindow"><h3>'+o+'<h3> <h4 class="uk-comment-title">Web: <a href="'+c+'" target="_blank"> <img class="uk-icon-small uk-float-right" src="data/img/open.png" alt="Open In New Browser">'+p+'</a></h4> <div class="uk-comment-meta"><p> Phone: '+u+" | Twitter: "+f+'</p></div></article><hr class="uk=grid-divider"/>';return l.indexOf(t.response.venues.name)>0&&i.indexOf(t.response.venues.name)&&a.indexOf(t.response.venues.name)?!1:(l.push({name:t.response.venues[r].name,url:t.response.venues[r].url,phone:t.response.venues[r].contact.formattedPhone,twitter:t.response.venues[r].contact.twitter,city:t.response.venues[r].location.city.toUpperCase(),add:t.response.venues[r].location.address,id:r}),i.push({name:t.response.venues[r].name,url:t.response.venues[r].url,phone:t.response.venues[r].contact.formattedPhone,twitter:t.response.venues[r].contact.twitter,city:t.response.venues[r].location.city.toUpperCase(),add:t.response.venues[r].location.address,id:r}),a.push(new google.maps.Marker({name:t.response.venues[r].name,map:e,position:n,icon:"https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png",infowindow:new google.maps.InfoWindow({content:m,id:r}),click:function(t){var n=this;$(a()).each(function(e){a()[e]!==a()[t]&&a()[e].infowindow.close()}),s.cityMarker.infowindow.close(),n.setAnimation(google.maps.Animation.BOUNCE),setTimeout(function(){n.setAnimation(null)},750),n.infowindow.open(e,this)}})),void 0)})}).fail(function(){alert("Api call failed")}).done(function(){console.log("foursquare data recieved: "+new Date),$(a()).each(function(t){a()[t].setMap(e),a()[t].addListener("click",a()[t].click)})}).always(function(){console.log("foursquare finished: "+new Date)})}}else alert(""===r?"Search requires an address":"Geocode was not successful for the following reason: "+c)})}var s=this;s.address=ko.observableArray(),s.filter=ko.observableArray(),s.venues=ko.observableArray();var o=s.venues;s.refineArr=ko.observableArray();var i=s.refineArr;s.markersArr=ko.observableArray();var a=s.markersArr;s.cityMarker=ko.observable(),s.bookmarks=ko.observableArray();var l=s.bookmarks;s.functions={markerSearch:function(e){var t=e.id;a()[t].click(t)},venueSearch:function(){var t=s.address(),i=s.filter();r(e,n,t,i,o)},bookmarkIt:function(e){var t=l.indexOf(e),n={info:e,marker:a()[e.id]};-1===t?(l.push(n),o.remove(e),n.marker.click(e.id)):(o.push(e.info),l.remove(e))},bookmarkSearch:function(t){t.marker.setMap(e,t.marker),t.marker.infowindow.open(e,t.marker),e.setCenter(t.marker.position)},refine:ko.observable(""),refineResults:function(t){var n=t.toString().toLowerCase();return o.removeAll(),ko.utils.arrayFilter(i(),function(r){if(r.name.indexOf(t.toLowerCase()>=0)){var s=r.name.toString().toLowerCase();s.indexOf(n)?(a()[r.id].setMap(null),o.remove(r)):(a()[r.id].setMap(e,this),o.push(r))}else $(i).each(function(t){o().push(this[t]),a()[t].setMap(e,this)})})}},s.functions.refine.subscribe(s.functions.refineResults)}function initMap(){var e,t={lat:47.605358,lng:-122.331099};e=new google.maps.Map(document.getElementById("map"),{zoom:8,center:t,disableDefaultUI:!0});var n=new google.maps.Geocoder;$(window).resize(function(){$("#map").height($(window).height()),$("#map").width($(window).width()),e.setCenter(t)});var r=[{featureType:"administrative",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"administrative.country",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"administrative.province",elementType:"geometry.stroke",stylers:[{visibility:"off"}]},{featureType:"landscape",elementType:"geometry",stylers:[{visibility:"on"},{color:"#e3e3e3"}]},{featureType:"landscape.natural",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi",elementType:"all",stylers:[{visibility:"off"}]},{featureType:"road",elementType:"all",stylers:[{color:"#cccccc"}]},{featureType:"road",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"transit",elementType:"labels.icon",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit.line",elementType:"labels.text",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"geometry",stylers:[{visibility:"off"}]},{featureType:"transit.station.airport",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#FFFFFF"}]},{featureType:"water",elementType:"labels",stylers:[{visibility:"off"}]}];e.setOptions({styles:r}),ko.applyBindings(new ViewModel(e,t,n))}var cityMarkersArr=[];
